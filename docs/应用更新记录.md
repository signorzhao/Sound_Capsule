# Sound Capsule 应用更新记录

本文档记录 Web 应用与后端的重要更新，供部署与维护参考。

---

## 2025-02-14 更新

### Web 前端

#### 国际化 (i18n)

- **登录后同步**：`SyncContext` 中「正在连接云端…」「正在同步服务器数据…」改为使用 `i18n.t('bootSync.xxx')`
- **Toast 弹窗**：所有操作反馈统一 i18n
  - 删除成功/失败、保存成功/失败、创建成功等（`common.*`）
  - `App.jsx`、`CapsuleTypeManager.jsx` 中硬编码中文已替换
- **BootSync**：错误文案 fallback 使用 `t('bootSync.error')`、`t('common.unknownError')`
- **InitialSetup**：完成向导后按当前 i18n 语言保存，不再强制 `zh-CN`

#### 输入体验

- **登录/注册**：降低中文输入法干扰
  - `onCompositionStart` 阻止 IME composition
  - `onChange` 过滤非 ASCII（用户名/邮箱/密码只允许英文数字符号）
  - `autoCorrect="off"`、`autoCapitalize="off"`、`spellCheck={false}`
  - `LoginPage.css` 中 `ime-mode: disabled`（Firefox 支持）

#### UI 调整

- **胶囊光晕**：底部光晕由 `filter: blur()` 改为 `box-shadow`
  - 解决部分环境下的矩形边框问题
  - 使用小圆点 + 柔和阴影，光晕更自然
  - 光晕位置调整到胶囊底部，避免出现在文字下方
  - 涉及：`CapsuleCard.jsx`、`CapsuleLibrary.jsx`

### Data Pipeline（Supabase 迁移）

- **009**：`009_cloud_capsules_embedding_pgvector.sql`
  - 启用 `vector` 扩展
  - `cloud_capsules` 增加 `embedding vector(384)` 列
  - 新增 `semantic_search_capsules` RPC（语义搜索）
- **010**：`010_tag_level_embedding.sql`
  - `cloud_capsule_tags` 增加 `embedding vector(384)` 列
  - 新增 `semantic_search_capsules_tag_level` RPC（标签级语义搜索）

### 部署注意

- 若启用语义搜索，需在 Supabase SQL Editor 中按顺序执行 **009**、**010**
- 执行 009 后，可用 `backfill_capsule_embeddings.py` 为已有胶囊填充 embedding

---
