# 🎵 REAPER → Synesth 导出功能使用指南

## 🎯 新的交互方式

**在 REAPER 中选中 Items → 按快捷键 → 浏览器自动打开 Synesth → 自动填充项目信息 → 点击导出 → 完成!**

## ⚙️ 设置 (只需一次)

### 第一步: 在 REAPER 中设置快捷键

1. 打开 REAPER
2. 按 `Cmd+R` (macOS) 或 `Ctrl+R` (Windows) 打开 Actions 列表
3. 在搜索框输入: `launch_synesth`
4. 找到: `ReaScript: launch_synesth.lua`
5. 右键点击 → "Add shortcut..." (或 "添加快捷键")
6. 按下你想用的快捷键,推荐:
   - macOS: `Cmd+Shift+S`
   - Windows: `Ctrl+Shift+S`
7. 关闭对话框

✅ 完成了!现在你可以使用这个快捷键了。

## 🚀 日常使用

### 完整流程

1. **在 REAPER 中**:
   - 选中你想要导出的音频 Items
   - 按快捷键 (例如: `Cmd+Shift+S`)

2. **自动触发**:
   - Lua 脚本自动记录项目信息
   - 浏览器自动打开 Synesth
   - 显示确认对话框

3. **在 Synesth 中**:
   - 页面自动检测并显示: "检测到 REAPER 触发"
   - 项目名称已自动填充
   - 填写主题名称 (例如: "钢琴独奏")
   - 点击"下一步"

4. **确认信息**:
   - 查看胶囊名称预览
   - 点击"确认并开始导出"

5. **自动导出**:
   - 点击"一键导出"
   - 等待 15-30 秒
   - 显示"导出成功"! ✅

## 📊 用户体验对比

### 传统方式
```
1. 在 REAPER 中选中 Items
2. 切换到 Synesth
3. 手动填写项目名、主题名
4. 切换回 REAPER
5. 手动运行导出脚本
6. 输入项目名、主题名
7. 等待导出
8. 切换回 Synesth
9. 点击"扫描并导入"
10. 完成

总操作: 9 步 | 需要切换窗口 3 次
```

### 新方式 (REAPER → Synesth)
```
1. 在 REAPER 中选中 Items
2. 按 Cmd+Shift+S (浏览器自动打开)
3. 填写主题名
4. 点击"一键导出"
5. 完成!

总操作: 4 步 | 需要切换窗口 0 次 (自动)
```

## 🎨 界面展示

### Synesth 自动检测触发

当从 REAPER 快捷键启动时,Synetsh 会显示绿色提示框:

```
✓ 检测到 REAPER 触发
  项目: 我的音乐项目 • 选中的 Items: 3
```

项目名称字段会自动填充为 "我的音乐项目",你只需要填写主题名称即可。

## 🔧 技术原理

### 工作流程

```
REAPER                              文件系统                      Synesth
  │                                  │                            │
  ├─ 选中 Items                      │                            │
  │                                  │                            │
  ├─ 按快捷键                         │                            │
  │                                  │                            │
  ├─ launch_synesth.lua             │                            │
  │  │                               │                            │
  │  ├─ 生成配置 ──────────────────>│                            │
  │  │   /tmp/reaper_trigger.json   │                            │
  │  │                               │                            │
  │  ├─ 打开浏览器 ──────────────────────────────────────────────>│
  │                                  │                            │
  │                                  │<───────────────────────────┤
  │                                  │  检查触发状态
  │                                  │                            │
  │                                  ├─ 读取配置 ───────────────>│
  │                                  │                            │
  │                                  │                            ├─ 自动填充项目名
  │                                  │                            │
  │                                  │                            ├─ 用户填写主题名
  │                                  │                            │
  │                                  │<───────────────────────────┤
  │                                  │  开始导出
  │                                  │                            │
  │<──────────────────────────────────────────────────────────────┤
  │  通过 OSC/脚本触发导出            │                            │
  │                                  │                            │
  ├─ 执行导出                         │                            │
  │                                  │                            │
  ├─ 生成胶囊 ─────────────────────>│                            │
  │                                  │                            │
  │                                  ├─ 扫描并导入 ──────────────>│
  │                                  │                            │
  │                                  │                            └─ 显示成功 ✓
```

### 通信机制

1. **REAPER → Synesth**
   - Lua 脚本生成 JSON 配置文件
   - 保存到 `/tmp/synest_export/reaper_trigger.json`
   - 通过 URL 参数打开 Synesth

2. **Synesth 读取**
   - 调用 `/api/capsules/check-reaper-trigger`
   - Python 读取配置文件
   - 返回项目信息给前端

3. **自动填充**
   - React useEffect 钩子检测触发
   - 自动填充项目名称
   - 显示绿色提示框

## 🐛 故障排除

### 问题 1: 快捷键没有反应

**检查:**
- 确认 Lua 脚本已正确安装
- 在 Actions 列表中搜索 "launch_synesth"
- 手动运行脚本测试

**解决:**
```bash
# 检查脚本是否存在
ls -la data-pipeline/lua_scripts/launch_synesth.lua
```

### 问题 2: 浏览器没有打开

**检查:**
- 查看 REAPER 控制台输出
- 检查系统默认浏览器设置

**解决:**
- 在 REAPER 中: Actions → Show console
- 查看错误信息

### 问题 3: Synesth 没有检测到触发

**检查:**
```bash
# 检查触发文件
cat /tmp/synest_export/reaper_trigger.json

# 应该看到类似:
{"project_name":"项目名","item_count":3,"trigger":"reaper"}
```

**解决:**
- 确保文件存在且格式正确
- 刷新 Synesth 页面

### 问题 4: 导出失败

**检查:**
- 确保在 REAPER 中选中了 Items
- 查看浏览器控制台输出
- 查看 API 服务器日志

**解决:**
```bash
# 查看 API 日志
cd data-pipeline
python capsule_api.py
# 观察输出
```

## 📝 下一步

这个方案已经提供了很好的用户体验,但如果你需要**完全自动化** (无需按快捷键),可以继续实现 OSC 方案:

### OSC 方案预览

1. 配置 REAPER OSC 服务器 (端口 9000)
2. Python 通过 OSC 发送命令
3. 触发 REAPER 中的导出 Action
4. 完全自动化,无需任何手动操作

详见: [docs/FINAL_SOLUTION.md](FINAL_SOLUTION.md)

## ✨ 总结

### 当前方案 (REAPER → Synesth)

✅ **优点:**
- 用户体验极佳
- 技术简单可靠
- 只需一次设置
- 项目信息自动填充
- 符合自然工作流

⚠️ **限制:**
- 需要按一次快捷键
- 需要手动填写主题名

### 未来方案 (OSC)

✅ **优点:**
- 完全自动化
- 无需任何手动操作

⚠️ **限制:**
- 需要配置 OSC
- 技术复杂度较高

## 🎉 享受使用!

现在你可以:
1. 在 REAPER 中专注创作
2. 选中 Items → 按 `Cmd+Shift+S`
3. 在浏览器中轻松完成导出
4. 无需繁琐的手动操作!

**音乐创作应该专注,而不是繁琐的操作。** 🎵
