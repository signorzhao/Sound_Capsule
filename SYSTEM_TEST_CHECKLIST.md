# Sound Capsule 系统全面测试清单

测试日期：_____________
测试人员：_____________
环境：本地开发环境

---

## 📋 测试概览

本测试清单覆盖 Sound Capsule 项目的三大核心模块：
1. **Anchor Editor v2.0** - 锚点编辑器（棱镜管理）
2. **Capsule API & Database** - 后端 API 和数据库
3. **Webapp Frontend** - 胶囊管理前端

---

## 🔧 测试前准备

- [✅] 确保所有 Python 依赖已安装 (`pip install -r requirements.txt`)
- [✅] 确保前端依赖已安装 (`cd webapp && npm install`)
- [✅] 确保 SQLite 数据库文件存在（`data-pipeline/database/capsules.db`）
- [✅] 确保 Anchor Editor 运行在 `http://localhost:5001`
- [✅] 确保 Capsule API 运行在 `http://localhost:5000`
- [✅] 确保 Webapp 运行在 `http://localhost:5173` 或 Tauri 应用已启动
- [✅] （可选）确保 Embedding API 运行在 `http://localhost:8000`（Phase C2）

---

## 📍 第一部分：Anchor Editor v2.0 测试

### 1.1 基础功能测试

#### 页面加载与显示
- [✅] 访问 `http://localhost:5001`，页面正常加载
- [✅] 左侧画布区域显示正常（地图、坐标轴）
- [✅] 右侧面板显示正常（标签页切换）
- [✅] 棱镜选择下拉框显示所有可用棱镜
- [✅] 当前选中的棱镜锚点在地图上正确显示

#### 锚点管理
- [✅] **添加锚点**：输入新词，按回车或点击 + 按钮，锚点成功添加
- [✅] **删除锚点**：点击锚点列表中的删除按钮，锚点成功删除
- [❌] **编辑锚点词**：修改锚点词汇，自动翻译功能正常工作（这功能不完美，希望翻译是AI自动生成
- [✅] **拖拽锚点**：在地图上拖拽锚点到新位置，坐标实时更新

#### 棱镜切换
- [✅] 切换不同棱镜（mechanics / texture / source / materiality）
- [✅] 切换后地图和锚点列表正确更新
- [✅] 棱镜配置独立，互不影响

### 1.2 语义力场重构

#### 基础重构
- [✅] 点击"保存并重构力场"按钮，进度条正常显示
- [✅] 重构完成后显示成功消息
- [✅] 重构结果保存到 `sonic_vectors.json`
- [✅] 检查 `sonic_vectors.json` 文件内容正确（包含 points 数据）

#### 类别过滤功能
- [✅] 选择不同的词汇类型过滤（形容词/名词/动词）
- [✅] 只选择"形容词"，重构后词汇数量减少
- [✅] 取消所有过滤，重构后词汇数量恢复
- [✅] 过滤结果正确（检查过滤类别是否生效）

#### 性能测试
- [✅] 测试重构速度（78 个锚点应在 1 分钟内完成）
- [ ] 测试大规模词汇（1000+ 词）重构性能
- [ ] 检查内存占用是否正常

### 1.3 棱镜 CRUD 操作

#### 创建新棱镜
- [✅] 切换到"棱镜管理"标签页
- [✅] 点击"创建新棱镜"
- [✅] 输入棱镜 ID、名称、描述
- [✅] 配置轴标签（正向/负向）
- [✅] 创建成功后，新棱镜出现在选择列表中

#### 更新棱镜配置
- [✅] 修改棱镜名称和描述
- [✅] 修改轴标签
- [✅] 保存后配置正确更新

#### 删除棱镜
- [✅] 点击"删除棱镜"按钮
- [✅] 确认删除对话框正常显示
- [✅] 删除后棱镜从列表中消失
- [✅] 配置文件中的棱镜数据被删除

#### 导入/导出棱镜配置
- [✅] 导出棱镜配置为 JSON 文件，下载成功
- [✅] 导入之前导出的 JSON 文件，配置恢复正确
- [✅] 导入格式错误的 JSON，显示错误提示

### 1.4 智能锚点生成

#### 自动生成锚点
- [✅] 点击"生成建议锚点"按钮
- [✅] 设置每个象限生成数量（例如 5 个）
- [✅] 选择词性过滤（形容词/名词/动词）
- [✅] 点击生成，成功生成锚点并分布在四个象限
- [✅] 生成的锚点词汇与轴标签语义相关

#### 锚点导入功能
- [✅] 上传 CSV 文件导入锚点
- [✅] 测试"替换"模式：原有锚点被完全替换
- [✅] 测试"合并"模式：新锚点与原有锚点合并
- [✅] 测试"追加"模式：新锚点追加到现有锚点
- [✅] CSV 格式错误时显示友好提示

### 1.5 历史版本管理（Phase C1）

#### 保存历史快照
- [ ] 修改锚点位置后点击"保存并重构力场"
- [ ] 切换到"历史版本"标签页
- [ ] 选择当前棱镜，能看到刚才保存的版本
- [ ] 版本时间戳正确

#### 历史版本列表
- [ ] 多次保存后，历史版本按时间倒序显示
- [ ] 每个版本显示时间戳和操作描述
- [ ] 历史版本数量限制为 20 个（自动清理旧版本）

#### 版本回滚（可选测试）
- [ ] 点击"回滚到此版本"按钮
- [ ] 确认对话框正常显示
- [ ] 回滚后锚点位置恢复到历史版本的位置
- [ ] 地图和锚点列表正确刷新
- [ ] 回滚操作本身也会被记录为新版本

### 1.6 数据持久化

#### 配置文件保存
- [ ] 修改锚点后，`anchor_config_v2.json` 文件立即更新
- [ ] 重启服务，配置正确加载
- [ ] JSON 格式正确，无语法错误

#### 输出文件
- [ ] 重构后 `sonic_vectors.json` 文件包含完整数据
- [ ] 文件包含所有棱镜的 points 数据
- [ ] 坐标范围在 [0, 100] 之间

---

## 🔌 第二部分：Capsule API & Database 测试

### 2.1 API 服务启动

- [✅] 启动 Capsule API 服务 (`python capsule_api.py`)
- [✅] 服务运行在 `http://localhost:5000`
- [✅] 访问健康检查端点，返回正常状态
- [✅] 控制台无错误日志

### 2.2 数据库连接

#### SQLite 数据库
- [✅] `capsules.db` 文件存在于 `data-pipeline/database/` 目录
- [✅] 数据库表结构正确（prisms, prism_versions 等表存在）
- [✅] 可以成功执行查询和写入操作
- [✅] 数据库文件权限正确（可读写）

### 2.3 胶囊 CRUD API

#### 创建胶囊
- [✅] POST `/api/capsules` 创建新胶囊
- [✅] 请求体包含必要字段（title, description, duration, tags 等）
- [✅] 返回创建的胶囊对象，包含 `_id`
- [✅] 胶囊保存到数据库

#### 获取胶囊列表
- [✅] GET `/api/capsules` 返回所有胶囊
- [✅] 列表按创建时间倒序排列
- [✅] 支持分页参数（limit, skip）
- [✅] 支持过滤参数（tags, search）

#### 获取单个胶囊
- [✅] GET `/api/capsules/:id` 返回指定胶囊
- [✅] ID 不存在时返回 404 错误
- [✅] 返回的胶囊数据完整

#### 更新胶囊
- [✅] PUT `/api/capsules/:id` 更新胶囊
- [✅] 只更新提供的字段，其他字段保持不变
- [✅] 返回更新后的胶囊对象
- [✅] 数据库中的数据已更新

#### 删除胶囊
- [✅] DELETE `/api/capsules/:id` 删除胶囊
- [✅] 返回成功消息
- [✅] 数据库中的胶囊被删除
- [✅] 再次查询返回 404

### 2.4 扫描与导入功能

#### 扫描本地音频文件
- [ ] 调用扫描 API，指定扫描路径
- [ ] 扫描到音频文件（.wav, .mp3, .m4a 等）
- [ ] 提取音频元数据（时长、采样率等）
- [ ] 扫描结果保存到数据库

#### REAPER 项目导入
- [✅] 上传 REAPER 项目文件（.rpp）
- [✅] 解析项目中的时间标记和区域
- [✅] 自动创建胶囊
- [✅] 关联的音频文件路径正确

### 2.5 语义向量计算

#### Embedding 生成
- [ ] 为胶囊标题和描述生成 embedding
- [ ] 使用 Phase C2 的 Embedding Service（本地或云端）
- [ ] Embedding 维度正确（384 维）
- [ ] 计算速度合理（< 2 秒/胶囊）

#### 相似度搜索
- [ ] 根据关键词搜索相似胶囊
- [ ] 返回结果按相似度排序
- [ ] 相似度分数合理（0-1 之间）
- [ ] 搜索性能可接受（< 1 秒）

### 2.6 云端同步功能（Phase B）

#### Supabase 连接
- [ ] Supabase 客户端正确初始化
- [ ] 环境变量配置正确（`.env.supabase`）
- [ ] 连接测试成功

#### 上传到云端
- [ ] 调用上传 API，胶囊上传到 Supabase
- [ ] 云端数据库中可以看到新记录
- [ ] 上传进度实时显示
- [ ] 错误处理正常（网络失败、权限错误等）

#### 从云端下载
- [ ] 调用下载 API，从 Supabase 拉取数据
- [ ] 本地数据库更新为云端数据
- [ ] 冲突解决策略正确（Last Write Wins）
- [ ] 下载进度实时显示

#### 双向同步
- [ ] 修改本地数据，执行同步，云端更新
- [ ] 修改云端数据，执行同步，本地更新
- [ ] 两边都有修改时，冲突正确解决
- [ ] 同步状态指示器正常工作

---

## 🎨 第三部分：Webapp Frontend 测试

### 3.1 应用启动

#### Tauri 应用
- [ ] 通过 Tauri 启动桌面应用
- [ ] 应用窗口正常显示
- [ ] 无白屏或崩溃现象

#### Web 开发服务器
- [ ] 运行 `npm run dev`，开发服务器启动
- [ ] 浏览器访问 `http://localhost:5173`
- [ ] 热重载功能正常（修改代码后自动刷新）

### 3.2 用户认证

#### 用户登录/登出
- [ ] 启动应用后检查登录状态
- [ ] 未登录时显示登录界面
- [ ] 登录后显示主界面
- [ ] 登出功能正常，清除本地数据

#### 用户信息显示
- [ ] 登录后显示用户头像和用户名
- [ ] 用户信息正确加载
- [ ] 点击头像显示用户菜单

### 3.3 胶囊库界面

#### 胶囊列表显示
- [ ] 胶囊库页面正常加载
- [ ] 胶囊卡片正确显示（标题、时长、标签等）
- [ ] 列表支持滚动加载更多
- [ ] 空状态显示友好提示

#### 搜索和过滤
- [ ] 搜索框输入关键词，实时过滤胶囊
- [ ] 标签过滤功能正常
- [ ] 排序功能（按时间、按时长）正常
- [ ] 清除过滤条件，列表恢复

#### 胶囊详情
- [ ] 点击胶囊卡片，打开详情页
- [ ] 详情页显示完整信息
- [ ] 音频播放器正常工作
- [ ] 可以播放/暂停音频
- [ ] 进度条可拖动

### 3.4 创建/保存胶囊

#### 基本信息输入
- [ ] 点击"新建胶囊"按钮
- [ ] 输入标题、描述
- [ ] 选择/输入标签
- [ ] 设置时长和日期

#### 语义位置选择
- [ ] 选择棱镜（mechanics / texture 等）
- [ ] 在语义地图上点击选择位置
- [ ] 坐标正确显示

#### 音频文件关联
- [ ] 上传音频文件
- [ ] 从本地文件选择器选择音频
- [ ] 音频文件路径正确保存
- [ ] 文件大小和格式验证

#### 保存胶囊
- [ ] 点击"保存"按钮
- [ ] 表单验证正常（必填字段检查）
- [ ] 保存成功后显示提示消息
- [ ] 新胶囊出现在胶囊库中

### 3.5 胶囊导出功能

#### REAPER 导出
- [ ] 选择多个胶囊进行导出
- [ ] 配置导出选项（时间标记、区域等）
- [ ] 点击"导出到 REAPER"
- [ ] 生成 .rpp 项目文件
- [ ] 文件下载成功

#### 批量导出
- [ ] 选择所有胶囊
- [ ] 执行批量导出
- [ ] 所有胶囊都正确导出
- [ ] 导出进度显示

### 3.6 设置面板

#### 打开设置
- [ ] 点击设置图标，打开设置面板
- [ ] 设置面板正确显示

#### 配置选项
- [ ] API 端点配置（本地/云端）
- [ ] 数据存储路径配置
- [ ] 音频设备选择
- [ ] 主题切换（深色/浅色模式）

#### 保存设置
- [ ] 修改设置后点击保存
- [ ] 设置正确持久化
- [ ] 重启应用后设置保持

### 3.7 缓存管理（Phase C）

#### 查看缓存状态
- [ ] 打开缓存管理面板
- [ ] 显示缓存大小和文件数量
- [ ] 区分本地缓存和云端缓存

#### 清理缓存
- [ ] 点击"清理本地缓存"
- [ ] 本地缓存文件被删除
- [ ] 界面显示新的缓存状态

#### 下载云端缓存
- [ ] 点击"从云端下载"
- [ ] 显示下载进度
- [ ] 下载完成后缓存可用

### 3.8 错误处理

#### 网络错误
- [ ] 断开网络连接，执行操作
- [ ] 显示友好的错误提示
- [ ] 提供"重试"按钮
- [ ] 网络恢复后可以重试

#### API 错误
- [ ] API 返回 500 错误
- [ ] 显示错误消息
- [ ] 不影响应用继续使用

#### 数据验证错误
- [ ] 提交空表单
- [ ] 提交无效数据
- [ ] 表单验证提示清晰

### 3.9 性能测试

#### 页面加载
- [ ] 首屏加载时间 < 3 秒
- [ ] 胶囊列表加载时间 < 1 秒
- [ ] 图片懒加载正常工作

#### 动画流畅度
- [ ] 页面切换动画流畅
- [ ] 列表滚动无卡顿
- [ ] 按钮点击反馈及时

#### 内存占用
- [ ] 应用运行 30 分钟，内存稳定
- [ ] 没有明显的内存泄漏
- [ ] 关闭窗口后进程正常退出

---

## 🔄 第四部分：集成测试

### 4.1 端到端工作流

#### 完整创作流程
1. [ ] 在 Anchor Editor 中创建/修改棱镜
2. [ ] 重构语义力场
3. [ ] 在 Webapp 中创建新胶囊
4. [ ] 在语义地图上选择位置
5. [ ] 关联音频文件
6. [ ] 保存胶囊
7. [ ] 在胶囊库中查看新胶囊
8. [ ] 导出为 REAPER 项目

#### 云端同步流程
1. [ ] 本地创建胶囊
2. [ ] 执行云端同步
3. [ ] 在另一个设备/浏览器登录
4. [ ] 执行同步，胶囊出现
5. [ ] 修改胶囊，再次同步
6. [ ] 检查两边数据一致性

### 4.2 数据一致性

#### 配置文件同步
- [ ] 修改 `anchor_config_v2.json`，所有服务读取最新配置
- [ ] 修改 `sonic_vectors.json`，前端显示最新数据

#### 跨服务数据
- [ ] Anchor Editor 生成的向量数据，Webapp 正确使用
- [ ] Webapp 创建的胶囊，API 正确保存

---

## 🐛 第五部分：已知问题和边缘情况

### 5.1 边缘情况测试

#### 空数据处理
- [ ] 锚点列表为空时的显示
- [ ] 胶囊库为空时的显示
- [ ] 搜索无结果时的提示

#### 特殊字符处理
- [ ] 胶囊标题包含特殊字符
- [ ] 标签包含中文/ emoji
- [ ] 文件路径包含空格

#### 并发操作
- [ ] 快速点击多个按钮
- [ ] 同时上传多个文件
- [ ] 快速切换页面

### 5.2 性能压力测试

#### 大数据量
- [ ] 创建 100+ 个锚点的棱镜，重构性能
- [ ] 创建 1000+ 个胶囊，列表加载性能
- [ ] 导出 100+ 个胶囊到 REAPER

#### 长时间运行
- [ ] 应用运行 2 小时，检查稳定性
- [ ] 反复创建/删除胶囊 100 次
- [ ] 反复重构语义力场 50 次

---

## 📊 测试结果统计

### 通过率统计
- Anchor Editor: _____ / _____ (_____%)
- Capsule API: _____ / _____ (_____%)
- Webapp Frontend: _____ / _____ (_____%)
- **总计**: _____ / _____ (_____%)

### 缺陷统计
- 严重缺陷：_____ 个
- 中等缺陷：_____ 个
- 轻微缺陷：_____ 个
- 优化建议：_____ 个

### 测试总结
```
（在此记录测试过程中的主要发现、整体评估和改进建议）
```

---

## ✅ 测试完成标准

- [ ] 所有核心功能测试通过
- [ ] 无严重缺陷
- [ ] 性能指标满足要求
- [ ] 用户体验流畅
- [ ] 文档完整

---

## 📝 测试记录

**测试人员签名**：_____________

**测试日期**：_____________

**下次测试计划时间**：_____________
