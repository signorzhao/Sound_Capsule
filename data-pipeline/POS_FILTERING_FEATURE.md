# è¯æ€§ç­›é€‰åŠŸèƒ½ - POS Filtering Feature

**æ›´æ–°æ—¶é—´**: 2026-01-07
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## åŠŸèƒ½æ¦‚è¿°

åœ¨åˆ›å»ºæ£±é•œæ—¶ç”Ÿæˆå»ºè®®é”šç‚¹æ—¶ï¼Œç”¨æˆ·ç°åœ¨å¯ä»¥é€‰æ‹©ç­›é€‰è¯æ€§ï¼ˆåè¯/åŠ¨è¯/å½¢å®¹è¯ï¼‰ï¼Œå¹¶ä¸”ç³»ç»Ÿä¿è¯åŒä¸€æ£±é•œå†…ç”Ÿæˆçš„é”šç‚¹è¯ä¸ä¼šé‡å¤ã€‚

---

## åŠŸèƒ½ç‰¹æ€§

### 1. è¯æ€§ç­›é€‰ï¼ˆPOS Filteringï¼‰

ç”¨æˆ·å¯ä»¥é€‰æ‹©ä»¥ä¸‹è¯æ€§ä¹‹ä¸€ï¼š
- **å…¨éƒ¨è¯æ€§** - ä¸è¿›è¡Œç­›é€‰ï¼Œä½¿ç”¨æ‰€æœ‰è¯æ±‡
- **åè¯ (Noun)** - ä»…ä½¿ç”¨åè¯
- **åŠ¨è¯ (Verb)** - ä»…ä½¿ç”¨åŠ¨è¯
- **å½¢å®¹è¯ (Adjective)** - ä»…ä½¿ç”¨å½¢å®¹è¯ï¼ˆé»˜è®¤æ¨èï¼‰

**é»˜è®¤è®¾ç½®**: å½¢å®¹è¯ï¼ˆAdjectiveï¼‰- å› ä¸ºå½¢å®¹è¯æœ€é€‚åˆæè¿°éŸ³è´¨å’Œæ„Ÿå—

### 2. å…¨å±€å»é‡ï¼ˆGlobal Deduplicationï¼‰

å¼ºåˆ¶æ¡ä»¶ï¼š**åŒä¸€æ£±é•œå†…ç”Ÿæˆçš„é”šç‚¹è¯ç»å¯¹ä¸é‡å¤**

- ç³»ç»Ÿåœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­ç»´æŠ¤ä¸€ä¸ªå…¨å±€å·²ä½¿ç”¨è¯æ±‡åˆ—è¡¨
- æ¯ä¸ªè±¡é™ç”Ÿæˆæ—¶ä¼šæ’é™¤å‰é¢è±¡é™å·²ä½¿ç”¨çš„è¯æ±‡
- ä¿è¯æ‰€æœ‰ 4 ä¸ªè±¡é™çš„ 20 ä¸ªé”šç‚¹è¯éƒ½æ˜¯å”¯ä¸€çš„

---

## ç•Œé¢å˜æ›´

### å‰ç«¯ UI

åœ¨åˆ›å»ºæ–°æ£±é•œçš„è¡¨å•ä¸­ï¼Œ"æ™ºèƒ½åŠŸèƒ½"åŒºåŸŸæ–°å¢äº†è¯æ€§é€‰æ‹©å™¨ï¼š

```html
<!-- è¯æ€§é€‰æ‹©å™¨ -->
<div style="margin-bottom:10px;">
    <label style="font-size:12px; color:#cbd5e1; display:block; margin-bottom:5px;">
        è¯æ€§ç­›é€‰ï¼ˆå¯é€‰ï¼‰
    </label>
    <select id="posFilterSelect">
        <option value="">å…¨éƒ¨è¯æ€§</option>
        <option value="noun">åè¯ (Noun)</option>
        <option value="verb">åŠ¨è¯ (Verb)</option>
        <option value="adjective" selected>å½¢å®¹è¯ (Adjective)</option>
    </select>
    <small style="color:#64748b; font-size:10px; display:block; margin-top:3px;">
        ğŸ’¡ é»˜è®¤æ¨èå½¢å®¹è¯ï¼Œé€‚åˆæè¿°éŸ³è´¨å’Œæ„Ÿå—
    </small>
</div>
```

### UI ç¤ºä¾‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ¨ æ™ºèƒ½åŠŸèƒ½                               â”‚
â”‚ åŸºäºè½´æ ‡ç­¾è‡ªåŠ¨ç”Ÿæˆ 20 ä¸ªå»ºè®®é”šç‚¹          â”‚
â”‚                                         â”‚
â”‚ è¯æ€§ç­›é€‰ï¼ˆå¯é€‰ï¼‰                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ å…¨éƒ¨è¯æ€§                            â”‚ â”‚
â”‚ â”‚ åè¯ (Noun)                         â”‚ â”‚
â”‚ â”‚ åŠ¨è¯ (Verb)                         â”‚ â”‚
â”‚ â”‚ å½¢å®¹è¯ (Adjective) âœ“               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ ğŸ’¡ é»˜è®¤æ¨èå½¢å®¹è¯ï¼Œé€‚åˆæè¿°éŸ³è´¨å’Œæ„Ÿå—   â”‚
â”‚                                         â”‚
â”‚ [ğŸ² ç”Ÿæˆå»ºè®®é”šç‚¹]                        â”‚
â”‚                                         â”‚
â”‚ âœ… ç”Ÿæˆäº† 20 ä¸ªå»ºè®®é”šç‚¹ï¼ˆå½¢å®¹è¯ï¼‰        â”‚
â”‚ ğŸ¯ å”¯ä¸€è¯æ±‡: 20 ä¸ªï¼ˆæ— é‡å¤ï¼‰            â”‚
â”‚ â€¢ Bright [adjective]                   â”‚
â”‚ â€¢ Cold [adjective]                     â”‚
â”‚ â€¢ Warm [adjective]                     â”‚
â”‚ ... ç­‰ 20 ä¸ª                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API å˜æ›´

### è¯·æ±‚å‚æ•°

**ç«¯ç‚¹**: `POST /api/lenses/<lens_id>/generate-anchors`

**æ–°å¢å‚æ•°**:

```json
{
  "count_per_quadrant": 5,
  "pos_filter": ["adjective"],  // æ–°å¢ï¼šè¯æ€§è¿‡æ»¤æ•°ç»„
  "axes": {
    "x_label": {"neg": "...", "pos": "..."},
    "y_label": {"neg": "...", "pos": "..."}
  }
}
```

**pos_filter å¯é€‰å€¼**:
- `null` æˆ–ä¸æä¾› - ä¸è¿›è¡Œç­›é€‰
- `["noun"]` - ä»…åè¯
- `["verb"]` - ä»…åŠ¨è¯
- `["adjective"]` - ä»…å½¢å®¹è¯
- `["adverb"]` - ä»…å‰¯è¯

### å“åº”æ ¼å¼

```json
{
  "success": true,
  "anchors": [
    {
      "word": "Bright",
      "x": 93.11,
      "y": 21.48,
      "zh": "æ˜äº®",
      "pos": "adjective"
    }
  ],
  "message": "æˆåŠŸç”Ÿæˆ 20 ä¸ªå»ºè®®é”šç‚¹ï¼ˆå½¢å®¹è¯ï¼‰",
  "pos_filter": ["adjective"],
  "unique_words": 20  // æ–°å¢ï¼šå”¯ä¸€è¯æ±‡æ•°é‡
}
```

---

## åç«¯å®ç°

### 1. anchor_generator.py ä¿®æ”¹

#### find_similar_words() - æ·»åŠ è¯æ€§è¿‡æ»¤å’Œå»é‡

**æ–°å¢å‚æ•°**:
- `pos_filter: List[str]` - è¯æ€§è¿‡æ»¤åˆ—è¡¨
- `exclude_words: List[str]` - è¦æ’é™¤çš„è¯æ±‡åˆ—è¡¨

**å…³é”®é€»è¾‘**:
```python
# è¯æ€§è¿‡æ»¤
if pos_filter and word_obj.get('pos'):
    pos = word_obj.get('pos', '').lower().strip()
    if pos not in [p.lower() for p in pos_filter]:
        continue

# é¿å…ä¸æ’é™¤è¯æ±‡é‡å¤
if word.lower() in [w.lower() for w in exclude_words]:
    continue
```

#### generate_anchors_for_quadrant() - ä¼ é€’è¿‡æ»¤å‚æ•°

**æ–°å¢å‚æ•°**:
- `pos_filter: List[str]` - è¯æ€§è¿‡æ»¤åˆ—è¡¨
- `exclude_words: List[str]` - è¦æ’é™¤çš„è¯æ±‡åˆ—è¡¨

**å…³é”®é€»è¾‘**:
```python
similar_words = self.find_similar_words(
    combined_keywords,
    top_k=count*3,
    pos_filter=pos_filter,
    exclude_words=exclude_words
)
```

#### generate_all_anchors() - å…¨å±€å»é‡

**æ–°å¢å‚æ•°**:
- `pos_filter: List[str]` - è¯æ€§è¿‡æ»¤åˆ—è¡¨

**å…³é”®é€»è¾‘**:
```python
all_anchors = []
used_words = []  # å…¨å±€å·²ä½¿ç”¨çš„è¯æ±‡åˆ—è¡¨

for x_label, y_label, x_dir, y_dir in quadrants:
    # ä¸ºå½“å‰è±¡é™ç”Ÿæˆé”šç‚¹ï¼Œä¼ å…¥å·²ä½¿ç”¨çš„è¯æ±‡ä»¥é¿å…é‡å¤
    anchors = self.generate_anchors_for_quadrant(
        x_label, y_label, x_dir, y_dir, count_per_quadrant,
        pos_filter=pos_filter,
        exclude_words=used_words
    )
    all_anchors.extend(anchors)

    # æ›´æ–°å·²ä½¿ç”¨è¯æ±‡åˆ—è¡¨
    for anchor in anchors:
        used_words.append(anchor['word'])

return all_anchors
```

### 2. anchor_editor_v2.py API ä¿®æ”¹

#### generate_suggested_anchors() - æ¥æ”¶è¯æ€§å‚æ•°

**æ–°å¢é€»è¾‘**:
```python
# è·å–è¯æ€§è¿‡æ»¤å‚æ•°
pos_filter = data.get('pos_filter', None)

# ç”Ÿæˆé”šç‚¹ï¼ˆä¼ å…¥è¯æ€§è¿‡æ»¤å‚æ•°ï¼‰
suggested_anchors = generator.generate_all_anchors(
    axes,
    count_per_quadrant,
    pos_filter=pos_filter
)

# æ„å»ºå“åº”æ¶ˆæ¯
message = f"æˆåŠŸç”Ÿæˆ {len(suggested_anchors)} ä¸ªå»ºè®®é”šç‚¹"
if pos_filter:
    pos_names = {
        'noun': 'åè¯',
        'verb': 'åŠ¨è¯',
        'adjective': 'å½¢å®¹è¯',
        'adverb': 'å‰¯è¯'
    }
    pos_text = 'ã€'.join([pos_names.get(p, p) for p in pos_filter])
    message += f"ï¼ˆ{pos_text}ï¼‰"

return jsonify({
    "success": True,
    "anchors": suggested_anchors,
    "message": message,
    "pos_filter": pos_filter,
    "unique_words": len(set(a['word'] for a in suggested_anchors))
})
```

---

## æµ‹è¯•ç»“æœ

### æµ‹è¯• 1: æ— è¯æ€§è¿‡æ»¤

```
ç”Ÿæˆäº† 12 ä¸ªé”šç‚¹
å”¯ä¸€è¯æ±‡: 12 ä¸ª
æ˜¯å¦æœ‰é‡å¤: False
ç¤ºä¾‹: {'word': 'Cold-hard', 'x': 5, 'y': 9.21, 'zh': 'å†·ç¡¬', 'pos': 'adjective'}
```

âœ… é€šè¿‡ - ç”Ÿæˆæ‰€æœ‰è¯æ€§çš„è¯æ±‡ï¼Œæ— é‡å¤

### æµ‹è¯• 2: å½¢å®¹è¯è¿‡æ»¤

```
ç”Ÿæˆäº† 12 ä¸ªé”šç‚¹
å”¯ä¸€è¯æ±‡: 12 ä¸ª
æ˜¯å¦æœ‰é‡å¤: False
è¯æ€§åˆ†å¸ƒ: ['adjective', 'adjective', 'adjective', 'adjective', 'adjective']
ç¤ºä¾‹é”šç‚¹:
  - Cold-hard (adjective) at (9.04, 6.12)
  - Icy (adjective) at (24.58, 11.87)
  - Warm (adjective) at (6.05, 18.36)
```

âœ… é€šè¿‡ - ä»…ç”Ÿæˆå½¢å®¹è¯ï¼Œæ— é‡å¤

### æµ‹è¯• 3: åè¯è¿‡æ»¤

```
ç”Ÿæˆäº† 12 ä¸ªé”šç‚¹
å”¯ä¸€è¯æ±‡: 12 ä¸ª
æ˜¯å¦æœ‰é‡å¤: False
è¯æ€§åˆ†å¸ƒ: ['noun', 'noun', 'noun', 'noun', 'noun']
ç¤ºä¾‹é”šç‚¹:
  - Solemn (noun) at (7.14, 5)
  - Serene (noun) at (5, 12.95)
  - Glance (noun) at (5, 5)
```

âœ… é€šè¿‡ - ä»…ç”Ÿæˆåè¯ï¼Œæ— é‡å¤

---

## ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯ 1: åˆ›å»ºéŸ³è´¨æè¿°æ£±é•œï¼ˆæ¨èå½¢å®¹è¯ï¼‰

1. æ‰“å¼€åˆ›å»ºæ–°æ£±é•œè¡¨å•
2. å¡«å†™è½´æ ‡ç­¾ï¼š
   - Xè½´: `Dark / (é»‘æš—)` â† â†’ `Bright / (æ˜äº®)`
   - Yè½´: `Cold / (å¯’å†·)` â† â†’ `Warm / (æ¸©æš–)`
3. **è¯æ€§ç­›é€‰**: é€‰æ‹© `å½¢å®¹è¯ (Adjective)`ï¼ˆé»˜è®¤å·²é€‰ä¸­ï¼‰
4. ç‚¹å‡» `ğŸ² ç”Ÿæˆå»ºè®®é”šç‚¹`
5. ç»“æœï¼š
   ```
   âœ… ç”Ÿæˆäº† 20 ä¸ªå»ºè®®é”šç‚¹ï¼ˆå½¢å®¹è¯ï¼‰
   ğŸ¯ å”¯ä¸€è¯æ±‡: 20 ä¸ªï¼ˆæ— é‡å¤ï¼‰
   â€¢ Bright [adjective]
   â€¢ Cold [adjective]
   â€¢ Warm [adjective]
   â€¢ Dark [adjective]
   â€¢ Icy [adjective]
   ... ç­‰ 20 ä¸ª
   ```

### åœºæ™¯ 2: åˆ›å»ºåŠ¨ä½œæ•ˆæœæ£±é•œï¼ˆé€‰æ‹©åŠ¨è¯ï¼‰

1. æ‰“å¼€åˆ›å»ºæ–°æ£±é•œè¡¨å•
2. å¡«å†™è½´æ ‡ç­¾ï¼š
   - Xè½´: `Slow / (ç¼“æ…¢)` â† â†’ `Fast / (å¿«é€Ÿ)`
   - Yè½´: `Gentle / (è½»æŸ”)` â† â†’ `Strong / (å¼ºçƒˆ)`
3. **è¯æ€§ç­›é€‰**: é€‰æ‹© `åŠ¨è¯ (Verb)`
4. ç‚¹å‡» `ğŸ² ç”Ÿæˆå»ºè®®é”šç‚¹`
5. ç»“æœï¼š
   ```
   âœ… ç”Ÿæˆäº† 20 ä¸ªå»ºè®®é”šç‚¹ï¼ˆåŠ¨è¯ï¼‰
   ğŸ¯ å”¯ä¸€è¯æ±‡: 20 ä¸ªï¼ˆæ— é‡å¤ï¼‰
   â€¢ Flow [verb]
   â€¢ Pulse [verb]
   â€¢ Move [verb]
   â€¢ Glide [verb]
   ... ç­‰ 20 ä¸ª
   ```

### åœºæ™¯ 3: åˆ›å»ºå¯¹è±¡åˆ†ç±»æ£±é•œï¼ˆé€‰æ‹©åè¯ï¼‰

1. æ‰“å¼€åˆ›å»ºæ–°æ£±é•œè¡¨å•
2. å¡«å†™è½´æ ‡ç­¾ï¼š
   - Xè½´: `Nature / (è‡ªç„¶)` â† â†’ `Artificial / (äººé€ )`
   - Yè½´: `Living / (ç”Ÿç‰©)` â† â†’ `Non-living / (éç”Ÿç‰©)`
3. **è¯æ€§ç­›é€‰**: é€‰æ‹© `åè¯ (Noun)`
4. ç‚¹å‡» `ğŸ² ç”Ÿæˆå»ºè®®é”šç‚¹`
5. ç»“æœï¼š
   ```
   âœ… ç”Ÿæˆäº† 20 ä¸ªå»ºè®®é”šç‚¹ï¼ˆåè¯ï¼‰
   ğŸ¯ å”¯ä¸€è¯æ±‡: 20 ä¸ªï¼ˆæ— é‡å¤ï¼‰
   â€¢ Tree [noun]
   â€¢ River [noun]
   â€¢ Machine [noun]
   â€¢ Stone [noun]
   ... ç­‰ 20 ä¸ª
   ```

---

## æŠ€æœ¯ç»†èŠ‚

### è¯æ€§æ ‡ç­¾æ ‡å‡†åŒ–

ç³»ç»Ÿä½¿ç”¨ä»¥ä¸‹æ ‡å‡†è¯æ€§æ ‡ç­¾ï¼š
- `noun` - åè¯
- `verb` - åŠ¨è¯
- `adjective` - å½¢å®¹è¯
- `adverb` - å‰¯è¯

æ‰€æœ‰è¯æ€§æ¯”è¾ƒéƒ½ä¼šè½¬æ¢ä¸ºå°å†™ï¼Œç¡®ä¿åŒ¹é…å‡†ç¡®ã€‚

### å»é‡ç®—æ³•

1. **å…¨å±€è¯æ±‡åˆ—è¡¨**: åœ¨ç”Ÿæˆæ•´ä¸ªæ£±é•œçš„é”šç‚¹æ—¶ç»´æŠ¤ä¸€ä¸ª `used_words` åˆ—è¡¨
2. **é€è±¡é™ç”Ÿæˆ**: æŒ‰é¡ºåºä¸ºæ¯ä¸ªè±¡é™ç”Ÿæˆé”šç‚¹
3. **æ’é™¤å·²ç”¨è¯**: æ¯æ¬¡ç”Ÿæˆæ–°è±¡é™æ—¶ï¼Œå°† `used_words` ä½œä¸º `exclude_words` å‚æ•°ä¼ é€’
4. **æ›´æ–°åˆ—è¡¨**: æ¯ä¸ªè±¡é™ç”Ÿæˆå®Œæˆåï¼Œå°†å…¶é”šç‚¹è¯æ·»åŠ åˆ° `used_words`

### ç›¸ä¼¼åº¦è®¡ç®—

- ä½¿ç”¨ `sentence-transformers` çš„ `paraphrase-multilingual-MiniLM-L12-v2` æ¨¡å‹
- ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—å…³é”®è¯ä¸è¯åº“è¯æ±‡çš„è¯­ä¹‰è·ç¦»
- è¿”å›æœ€ç›¸ä¼¼çš„è¯æ±‡ä½œä¸ºé”šç‚¹å»ºè®®

---

## æ€§èƒ½å½±å“

- **è¯æ€§ç­›é€‰**: å‡ ä¹æ— æ€§èƒ½å½±å“ï¼ˆç®€å•çš„å­—ç¬¦ä¸²æ¯”è¾ƒï¼‰
- **å»é‡æ£€æŸ¥**: O(n) å¤æ‚åº¦ï¼Œn ä¸ºå·²ç”Ÿæˆé”šç‚¹æ•°é‡ï¼ˆæœ€å¤š 20 ä¸ªï¼‰
- **æ€»ç”Ÿæˆæ—¶é—´**: < 1 ç§’ï¼ˆæ¨¡å‹å·²åŠ è½½çš„æƒ…å†µä¸‹ï¼‰

---

## å·²çŸ¥é™åˆ¶

1. **è¯æ€§æ ‡ç­¾å‡†ç¡®æ€§**: ä¾èµ–äº `master_lexicon_v3.csv` ä¸­çš„è¯æ€§æ ‡æ³¨
2. **è¯æ±‡åº“å¤§å°**: å¦‚æœæŸä¸ªè¯æ€§çš„è¯æ±‡ä¸è¶³ï¼Œå¯èƒ½æ— æ³•ç”Ÿæˆè¶³å¤Ÿæ•°é‡çš„é”šç‚¹
3. **å¤§å°å†™æ•æ„Ÿ**: å»é‡æ—¶è½¬æ¢ä¸ºå°å†™æ¯”è¾ƒï¼Œä½†ä¿ç•™åŸå§‹å¤§å°å†™æ˜¾ç¤º

---

## æœªæ¥ä¼˜åŒ–å»ºè®®

1. **å¤šè¯æ€§ç­›é€‰**: æ”¯æŒåŒæ—¶é€‰æ‹©å¤šä¸ªè¯æ€§ï¼ˆå¦‚ `["noun", "adjective"]`ï¼‰
2. **æ™ºèƒ½æ¨è**: æ ¹æ®è½´æ ‡ç­¾è‡ªåŠ¨æ¨èæœ€åˆé€‚çš„è¯æ€§
3. **è¯åº“ç»Ÿè®¡**: æ˜¾ç¤ºæ¯ä¸ªè¯æ€§çš„å¯ç”¨è¯æ±‡æ•°é‡
4. **è‡ªå®šä¹‰è¯åº“**: å…è®¸ç”¨æˆ·ä¸Šä¼ è‡ªå·±çš„è¯åº“æ–‡ä»¶

---

## ç›¸å…³æ–‡æ¡£

1. [SMART_GENERATION_READY.md](SMART_GENERATION_READY.md) - æ™ºèƒ½é”šç‚¹ç”ŸæˆåŸºç¡€åŠŸèƒ½
2. [AUTO_CREATE_CSV_FEATURE.md](AUTO_CREATE_CSV_FEATURE.md) - è‡ªåŠ¨åˆ›å»ºè¯åº“æ–‡ä»¶
3. [FIX_SUMMARY_2026-01-07.md](FIX_SUMMARY_2026-01-07.md) - é—®é¢˜ä¿®å¤æ€»ç»“

---

**åŠŸèƒ½çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡
**æœ€åæ›´æ–°**: 2026-01-07
**åˆ›å»ºè€…**: Claude (Sonnet 4.5)
